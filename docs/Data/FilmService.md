# FilmService - Documentation technique compl√®te

## Table des mati√®res

1. [Vue d'ensemble](#vue-densemble)
2. [R√¥le et responsabilit√©s](#r√¥le-et-responsabilit√©s)
3. [Configuration](#configuration)
4. [Signaux](#signaux)
5. [M√©thodes publiques](#m√©thodes-publiques)
6. [Gestion des erreurs](#gestion-des-erreurs)
7. [HttpRequest Felgo](#httprequest-felgo)
8. [Flux de communication](#flux-de-communication)
9. [Exemples d'utilisation](#exemples-dutilisation)
10. [Configuration multi-environnement](#configuration-multi-environnement)
11. [Retry automatique](#retry-automatique)
12. [√âvolutions futures](#√©volutions-futures)
13. [Bonnes pratiques](#bonnes-pratiques)
14. [Testing](#testing)

---

## Vue d'ensemble

### D√©finition

`FilmService` est un **service r√©seau** responsable de toutes les communications HTTP avec l'API backend Django REST Framework. Il encapsule la logique de communication et √©met des signaux pour notifier les r√©sultats.

### Localisation

```
qml/model/FilmService.qml
```

### R√¥le

‚úÖ **Communication HTTP** avec le backend  
‚úÖ **Parsing JSON** des r√©ponses  
‚úÖ **√âmission de signaux** pour r√©sultats asynchrones  
‚úÖ **Gestion des erreurs** r√©seau et HTTP  
‚úÖ **Pas de logique m√©tier** - communication pure  

### Caract√©ristiques

- **Type** : Composant QML standard (pas Singleton)
- **Instanci√© dans** : CatalogueLogic
- **Pattern** : Observer (signaux/slots)
- **Asynchrone** : Tous les appels sont non-bloquants

---

## R√¥le et responsabilit√©s

### Ce que FilmService FAIT

**‚úÖ Appels HTTP**
```qml
HttpRequest.get(apiUrl + "/movies/")  // GET
HttpRequest.post(apiUrl + "/movies/", data)  // POST (futur)
HttpRequest.put(apiUrl + "/movies/1/", data)  // PUT (futur)
HttpRequest.del(apiUrl + "/movies/1/")  // DELETE (futur)
```

**‚úÖ Parsing JSON**
```qml
.then(function(response) {
    var films = JSON.parse(response)  // String ‚Üí Object
    filmsFetched(films)
})
```

**‚úÖ Gestion d'erreurs**
```qml
.catch(function(error) {
    fetchError("Erreur: " + error)
})
```

**‚úÖ √âmission de signaux**
```qml
signal filmsFetched(var films)
signal fetchError(string message)
```

### Ce que FilmService ne FAIT PAS

**‚ùå Pas de transformation de donn√©es**
```qml
// ‚ùå MAUVAIS
.then(function(response) {
    var films = JSON.parse(response)
    var sorted = films.sort(...)  // ‚ùå Logique m√©tier
    filmsFetched(sorted)
})

// ‚úÖ BON
.then(function(response) {
    filmsFetched(JSON.parse(response))  // ‚úÖ Donn√©es brutes
})
```

**‚ùå Pas de stockage d'√©tat**
```qml
// ‚ùå MAUVAIS
property var cachedFilms: []  // ‚ùå √âtat dans Service

// ‚úÖ BON : √âtat dans Model
// FilmDataSingletonModel g√®re l'√©tat
```

**‚ùå Pas d'acc√®s direct au Model**
```qml
// ‚ùå MAUVAIS
.then(function(response) {
    FilmDataSingletonModel.films = JSON.parse(response)  // ‚ùå
})

// ‚úÖ BON : Via signal
.then(function(response) {
    filmsFetched(JSON.parse(response))  // ‚úÖ Signal
})
```

---

## Configuration

### Propri√©t√© `apiUrl`

**Type** : `string`  
**D√©faut** : `"https://localhost:8000/api"`  
**Modifiable** : ‚úÖ Oui  
**Configurable via** : Propri√©t√© directe lors de l'instanciation

**Description** : URL de base de l'API backend Django REST.

**Structure d'URL compl√®te** :
```
apiUrl + endpoint
‚Üì
https://localhost:8000/api + /movies/
‚Üì
https://localhost:8000/api/movies/
```

**D√©claration** :

```qml
Item {
    id: filmService
    
    // Configuration
    property string apiUrl: "https://localhost:8000/api"
}
```

**Utilisation dans les m√©thodes** :

```qml
function fetchAllFilms() {
    let url = apiUrl + "/movies/"  // Concat√©nation
    
    HttpRequest.get(url)
        .then(...)
        .catch(...)
}
```

**Configuration selon environnement** :

```qml
// D√©veloppement
apiUrl: "http://localhost:8000/api"

// Staging
apiUrl: "https://staging.cinevault.com/api"

// Production
apiUrl: "https://api.cinevault.com/api"
```

---

## Signaux

Les signaux sont le m√©canisme pour communiquer les r√©sultats asynchrones aux consommateurs du service (g√©n√©ralement les Logic).

### Signal `filmsFetched(var films)`

**Type** : Signal avec param√®tre  
**Param√®tre** : `films` (array d'objets)  
**√âmis quand** : Succ√®s d'un appel API GET /movies/

**Structure du param√®tre `films`** :

```javascript
[
    {
        id: number,           // ID unique du film
        title: string,        // Titre du film
        poster_url: string,   // URL du poster
        // ... autres champs selon backend
    },
    // ... autres films
]
```

**Exemple de donn√©es r√©elles** :

```javascript
[
    {
        id: 1,
        title: "Avatar",
        poster_url: "https://image.tmdb.org/t/p/w342/jRXYjXNq0Cs2TcJjLkki24MLp7u.jpg",
        year: 2009,
        duration: 162,
        genres: ["Action", "Adventure", "Fantasy"]
    },
    {
        id: 2,
        title: "Titanic",
        poster_url: "https://image.tmdb.org/t/p/w342/9xjZS2rlVxm8SFx8kPC3aIGCOYQ.jpg",
        year: 1997,
        duration: 194,
        genres: ["Drama", "Romance"]
    }
]
```

**√âmission** :

```qml
HttpRequest.get(url)
    .then(function(response) {
        try {
            var films = JSON.parse(response)
            filmsFetched(films)  // ‚Üê √âmet le signal
        } catch(e) {
            fetchError("R√©ponse JSON invalide")
        }
    })
```

**√âcoute dans Logic** :

```qml
Connections {
    target: filmService
    
    function onFilmsFetched(films) {
        console.log("‚úÖ Re√ßu", films.length, "films")
        
        // Transformation si n√©cessaire
        var transformedFilms = films.map(function(f) {
            return {
                id: f.id,
                title: f.title,
                poster_url: f.poster_url
            }
        })
        
        // Stockage dans Model
        Model.FilmDataSingletonModel.updateFromAPI(transformedFilms)
    }
}
```

### Signal `fetchError(string errorMessage)`

**Type** : Signal avec param√®tre  
**Param√®tre** : `errorMessage` (string)  
**√âmis quand** : √âchec d'un appel API (erreur r√©seau, HTTP, ou parsing)

**Types de messages d'erreur** :

| Type | Message | Exemple |
|------|---------|---------|
| R√©seau | `"Erreur HTTP et/ou √âchec de connexion au serveur : NetworkError"` | Pas de connexion internet |
| HTTP 404 | `"Erreur HTTP et/ou √âchec de connexion au serveur : 404"` | Endpoint inexistant |
| HTTP 500 | `"Erreur HTTP et/ou √âchec de connexion au serveur : 500"` | Erreur serveur |
| JSON | `"R√©ponse JSON invalide"` | R√©ponse non-JSON |

**√âmission** :

```qml
HttpRequest.get(url)
    .then(function(response) {
        try {
            filmsFetched(JSON.parse(response))
        } catch(e) {
            fetchError("R√©ponse JSON invalide")  // ‚Üê √âmission
            console.warn("Erreur de parsing JSON:", e)
        }
    })
    .catch(function(error) {
        fetchError("Erreur HTTP: " + error)  // ‚Üê √âmission
        console.error("Erreur r√©cup√©ration films:", error)
    })
```

**√âcoute dans Logic** :

```qml
Connections {
    target: filmService
    
    function onFetchError(errorMessage) {
        console.error("‚ùå Erreur API:", errorMessage)
        
        // 1. Enregistrer dans Model
        Model.FilmDataSingletonModel.setError(errorMessage)
        
        // 2. Propager √† la Vue
        errorOccurred(errorMessage)
    }
}
```

---

## M√©thodes publiques

### `fetchAllFilms()`

R√©cup√®re la liste compl√®te des films depuis l'API backend.

**Param√®tres** : Aucun  
**Retour** : `void` (r√©sultat via signaux)  
**Asynchrone** : ‚úÖ Oui (non-bloquant)

**Endpoint appel√©** : `GET {apiUrl}/movies/`

**Exemple d'URL compl√®te** :
```
GET https://localhost:8000/api/movies/
```

**Impl√©mentation compl√®te** :

```qml
function fetchAllFilms() {
    // 1. Construction de l'URL
    let url = apiUrl + "/movies/"
    
    console.log("üåê Appel API:", url)
    
    // 2. Requ√™te HTTP GET
    HttpRequest.get(url)
        .then(function(response) {
            // 3a. Succ√®s : Parse JSON
            try {
                var films = JSON.parse(response)
                console.log("üì¶ R√©ponse API:", films.length, "films")
                
                // 4a. √âmet signal de succ√®s
                filmsFetched(films)
                
            } catch(e) {
                // 3b. √âchec parsing JSON
                console.warn("‚ö†Ô∏è Erreur de parsing JSON:", e)
                fetchError("R√©ponse JSON invalide")
            }
        })
        .catch(function(error) {
            // 3c. √âchec HTTP
            console.error("‚ùå Erreur HTTP:", error)
            fetchError("Erreur HTTP et/ou √âchec de connexion au serveur : " + error)
        })
}
```

**Flux d'ex√©cution** :

```
1. fetchAllFilms() appel√©
   ‚Üì
2. Construction URL : apiUrl + "/movies/"
   ‚Üì
3. HttpRequest.get(url)
   ‚Üì
4. Envoi requ√™te HTTP au backend
   ‚Üì
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ           ‚îÇ            ‚îÇ
   ‚ñº           ‚ñº            ‚ñº
Succ√®s      Erreur HTTP  Erreur R√©seau
   ‚îÇ           ‚îÇ            ‚îÇ
   ‚îú‚îÄ JSON OK  ‚îú‚îÄ 404       ‚îú‚îÄ NetworkError
   ‚îÇ           ‚îú‚îÄ 500       ‚îú‚îÄ Timeout
   ‚îÇ           ‚îî‚îÄ 401       ‚îî‚îÄ DNS
   ‚îÇ
   ‚ñº
filmsFetched(films)
   OU
fetchError(message)
```

**Appel√© par** :

```qml
// Dans CatalogueLogic
function refreshCatalogue() {
    Model.FilmDataSingletonModel.startLoading()
    filmService.fetchAllFilms()  // ‚Üê Appel
}
```

**R√©ponse attendue du backend** :

```json
[
    {
        "id": 1,
        "title": "Avatar",
        "poster_url": "https://image.tmdb.org/t/p/w342/jRXYjXNq0Cs2TcJjLkki24MLp7u.jpg"
    },
    {
        "id": 2,
        "title": "Titanic",
        "poster_url": "https://image.tmdb.org/t/p/w342/9xjZS2rlVxm8SFx8kPC3aIGCOYQ.jpg"
    }
]
```

---

## Gestion des erreurs

FilmService g√®re **3 types d'erreurs** :

### Type 1 : Erreur r√©seau

**Causes** :
- Pas de connexion internet
- Timeout de requ√™te
- DNS ne r√©sout pas
- Serveur inaccessible
- Firewall bloque

**D√©tection** :

```qml
HttpRequest.get(url)
    .catch(function(error) {
        // error contient "NetworkError", "Timeout", etc.
        fetchError("Erreur HTTP et/ou √âchec de connexion au serveur : " + error)
    })
```

**Message √©mis** :
```
"Erreur HTTP et/ou √âchec de connexion au serveur : NetworkError"
```

**Exemple de log console** :
```
‚ùå Erreur r√©cup√©ration films: NetworkError: Connection refused
```

### Type 2 : Erreur HTTP

**Causes** :
- 404 Not Found (endpoint inexistant)
- 500 Internal Server Error (bug backend)
- 401 Unauthorized (pas authentifi√©)
- 403 Forbidden (pas autoris√©)

**D√©tection** :

```qml
HttpRequest.get(url)
    .catch(function(error) {
        // error contient le code HTTP
        fetchError("Erreur HTTP et/ou √âchec de connexion au serveur : " + error)
    })
```

**Messages √©mis** :
```
"Erreur HTTP et/ou √âchec de connexion au serveur : 404"
"Erreur HTTP et/ou √âchec de connexion au serveur : 500"
"Erreur HTTP et/ou √âchec de connexion au serveur : 401"
```

**Exemple de log console** :
```
‚ùå Erreur r√©cup√©ration films: HTTP 404 Not Found
```

### Type 3 : Erreur parsing JSON

**Causes** :
- R√©ponse n'est pas du JSON valide
- Backend retourne du HTML (page d'erreur)
- R√©ponse vide
- JSON malform√©

**D√©tection** :

```qml
.then(function(response) {
    try {
        var films = JSON.parse(response)  // ‚Üê Peut lancer exception
        filmsFetched(films)
    } catch(e) {
        // Exception captur√©e ici
        fetchError("R√©ponse JSON invalide")
        console.warn("Erreur de parsing JSON:", e)
    }
})
```

**Message √©mis** :
```
"R√©ponse JSON invalide"
```

**Exemple de log console** :
```
‚ö†Ô∏è Erreur de parsing JSON: SyntaxError: Unexpected token < in JSON at position 0
```

**Exemple de r√©ponse causant l'erreur** :
```html
<!DOCTYPE html>
<html>
<head><title>Error 500</title></head>
<body><h1>Internal Server Error</h1></body>
</html>
```

### Propagation des erreurs

```
FilmService.fetchError(message)
          ‚Üì Signal
CatalogueLogic.onFetchError(message)
          ‚Üì
          ‚îú‚îÄ> FilmDataSingletonModel.setError(message)
          ‚îÇ   ‚îî‚îÄ> lastError = message
          ‚îÇ
          ‚îî‚îÄ> errorOccurred(message) signal
              ‚Üì
CataloguePage.onErrorOccurred(message)
              ‚Üì
          errorModal.open()
```

---

## HttpRequest Felgo

`HttpRequest` est l'API Felgo pour effectuer des requ√™tes HTTP. C'est un wrapper autour de `XMLHttpRequest` avec une syntaxe moderne (Promises).

### M√©thodes disponibles

```qml
// GET
HttpRequest.get(url)

// POST
HttpRequest.post(url)
    .body(JSON.stringify(data))

// PUT
HttpRequest.put(url)
    .body(JSON.stringify(data))

// DELETE
HttpRequest.del(url)
```

### Syntaxe Promise

```qml
HttpRequest.get(url)
    .then(function(response) {
        // Succ√®s : response est une string
        console.log("R√©ponse:", response)
    })
    .catch(function(error) {
        // Erreur : error est une string
        console.error("Erreur:", error)
    })
```

### Headers personnalis√©s

```qml
HttpRequest.get(url)
    .header("Authorization", "Bearer " + token)
    .header("Content-Type", "application/json")
    .then(...)
```

### Timeout

```qml
HttpRequest.get(url)
    .timeout(5000)  // 5 secondes
    .then(...)
```

### Caract√©ristiques

‚úÖ **Asynchrone** : N'bloque pas l'UI  
‚úÖ **Cross-platform** : iOS, Android, Desktop  
‚úÖ **Gestion automatique** : Encoding, headers par d√©faut  
‚úÖ **Promise-based** : Syntaxe moderne et lisible  

### Exemple complet

```qml
HttpRequest.get("https://api.example.com/data")
    .header("Authorization", "Bearer abc123")
    .timeout(10000)
    .then(function(response) {
        var data = JSON.parse(response)
        console.log("Data:", data)
    })
    .catch(function(error) {
        console.error("Error:", error)
    })
```

---

## Flux de communication

### Diagramme de s√©quence complet

```
CatalogueLogic    FilmService     HttpRequest     Backend API     CatalogueLogic    FilmDataSingleton
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ refreshCatalogue()             ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ           startLoading()       ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ   isLoading=true ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ  fetchAllFilms()‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ get(url)      ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ GET /movies/   ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ JSON response  ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ then(response)‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ JSON.parse()  ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ filmsFetched   ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ   (signal)     ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ onFilmsFetched()               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ Transformation ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ          updateFromAPI()          ‚îÇ
      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ   films=[...]    ‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ   isLoading=false‚îÇ
      ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ                ‚îÇ                  ‚îÇ
```

### Flux en pseudo-code

```javascript
// 1. Logic d√©marre
CatalogueLogic.refreshCatalogue() {
    FilmDataSingletonModel.startLoading()
    filmService.fetchAllFilms()
}

// 2. Service fait l'appel
FilmService.fetchAllFilms() {
    HttpRequest.get(apiUrl + "/movies/")
        .then(response => {
            films = JSON.parse(response)
            emit filmsFetched(films)
        })
        .catch(error => {
            emit fetchError("Erreur: " + error)
        })
}

// 3. Logic re√ßoit r√©sultat
CatalogueLogic.onFilmsFetched(films) {
    transformedFilms = films.map(transform)
    FilmDataSingletonModel.updateFromAPI(transformedFilms)
}

// 4. Model notifie Vue (binding automatique)
FilmDataSingletonModel.updateFromAPI(films) {
    this.films = films
    this.isLoading = false
    // ‚Üë D√©clenche bindings dans toutes les vues
}
```

---

## Exemples d'utilisation

### Exemple 1 : Usage basique dans Logic

```qml
import QtQuick 2.15
import Felgo 4.0
import "../model" as Model

Item {
    id: catalogueLogic
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // INSTANCE DU SERVICE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    Model.FilmService {
        id: filmService
        apiUrl: "https://localhost:8000/api"
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // √âCOUTE DES SIGNAUX
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    Connections {
        target: filmService
        
        function onFilmsFetched(films) {
            console.log("‚úÖ Succ√®s:", films.length, "films re√ßus")
            
            // Transformation
            var transformed = films.map(function(f) {
                return {
                    id: f.id,
                    title: f.title,
                    poster_url: f.poster_url
                }
            })
            
            // Stockage
            Model.FilmDataSingletonModel.updateFromAPI(transformed)
        }
        
        function onFetchError(errorMessage) {
            console.log("‚ùå Erreur:", errorMessage)
            Model.FilmDataSingletonModel.setError(errorMessage)
            errorOccurred(errorMessage)
        }
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // M√âTHODE PUBLIQUE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    function refreshCatalogue() {
        Model.FilmDataSingletonModel.startLoading()
        filmService.fetchAllFilms()
    }
}
```

### Exemple 2 : Configuration multi-environnement

```qml
Model.FilmService {
    id: filmService
    
    // Configuration selon environnement
    apiUrl: {
        // Argument ligne de commande : --prod, --staging, --dev
        var args = Qt.application.arguments
        
        if (args.indexOf("--prod") !== -1) {
            return "https://api.cinevault.com/api"
        } else if (args.indexOf("--staging") !== -1) {
            return "https://staging-api.cinevault.com/api"
        } else {
            return "http://localhost:8000/api"  // Dev par d√©faut
        }
    }
    
    Component.onCompleted: {
        console.log("üîß FilmService configur√©:", apiUrl)
    }
}
```

### Exemple 3 : Retry automatique

```qml
Item {
    id: catalogueLogic
    
    Model.FilmService {
        id: filmService
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // PROPRI√âT√âS DE RETRY
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    property int retryCount: 0
    property int maxRetries: 3
    property int retryDelay: 2000  // 2 secondes
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // TIMER DE RETRY
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    Timer {
        id: retryTimer
        interval: retryDelay
        repeat: false
        onTriggered: {
            console.log("üîÑ Retry", retryCount, "/", maxRetries)
            filmService.fetchAllFilms()
        }
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // CONNEXIONS AVEC RETRY
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    Connections {
        target: filmService
        
        function onFilmsFetched(films) {
            // Succ√®s : reset retry count
            retryCount = 0
            
            // Traitement normal
            var transformed = films.map(f => ({
                id: f.id,
                title: f.title,
                poster_url: f.poster_url
            }))
            
            Model.FilmDataSingletonModel.updateFromAPI(transformed)
        }
        
        function onFetchError(errorMessage) {
            if (retryCount < maxRetries) {
                // Retry automatique
                retryCount++
                console.log("‚ö†Ô∏è Erreur, retry dans", retryDelay, "ms...")
                retryTimer.start()
            } else {
                // Max retries atteint
                console.error("‚ùå Max retries atteint:", errorMessage)
                retryCount = 0
                Model.FilmDataSingletonModel.setError(errorMessage)
                errorOccurred(errorMessage)
            }
        }
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // FONCTION PUBLIQUE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    function refreshCatalogue() {
        retryCount = 0  // Reset au d√©marrage manuel
        Model.FilmDataSingletonModel.startLoading()
        filmService.fetchAllFilms()
    }
}
```

### Exemple 4 : Logs d√©taill√©s

```qml
Connections {
    target: filmService
    
    function onFilmsFetched(films) {
        console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê")
        console.log("‚úÖ API SUCCESS")
        console.log("Films re√ßus:", films.length)
        console.log("Premier film:", films[0] ? films[0].title : "N/A")
        console.log("Dernier film:", films[films.length-1] ? films[films.length-1].title : "N/A")
        console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê")
        
        // Traitement
        Model.FilmDataSingletonModel.updateFromAPI(films)
    }
    
    function onFetchError(errorMessage) {
        console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê")
        console.error("‚ùå API ERROR")
        console.error("Message:", errorMessage)
        console.error("API URL:", filmService.apiUrl)
        console.error("Timestamp:", new Date().toISOString())
        console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê")
        
        // Traitement
        Model.FilmDataSingletonModel.setError(errorMessage)
    }
}
```

---

## Configuration multi-environnement

### Via arguments ligne de commande

```bash
# D√©veloppement (d√©faut)
./CinevaultApp

# Staging
./CinevaultApp --staging

# Production
./CinevaultApp --prod
```

**Impl√©mentation** :

```qml
Model.FilmService {
    id: filmService
    
    property string environment: {
        var args = Qt.application.arguments
        if (args.indexOf("--prod") !== -1) return "production"
        if (args.indexOf("--staging") !== -1) return "staging"
        return "development"
    }
    
    apiUrl: {
        switch(environment) {
            case "production":
                return "https://api.cinevault.com/api"
            case "staging":
                return "https://staging-api.cinevault.com/api"
            case "development":
            default:
                return "http://localhost:8000/api"
        }
    }
    
    Component.onCompleted: {
        console.log("üåç Environment:", environment)
        console.log("üîó API URL:", apiUrl)
    }
}
```

### Via fichier de configuration

```qml
// config.json
{
    "api": {
        "development": "http://localhost:8000/api",
        "staging": "https://staging-api.cinevault.com/api",
        "production": "https://api.cinevault.com/api"
    }
}

// FilmService.qml
property var config: JSON.parse(FileUtils.readFile("config.json"))
property string environment: "development"
apiUrl: config.api[environment]
```

---

## Retry automatique

### Strat√©gie exponentielle

```qml
property int retryCount: 0
property int maxRetries: 5
property int baseDelay: 1000  // 1 seconde

// D√©lai exponentiel : 1s, 2s, 4s, 8s, 16s
property int retryDelay: baseDelay * Math.pow(2, retryCount)

Timer {
    id: retryTimer
    interval: retryDelay
    onTriggered: {
        filmService.fetchAllFilms()
    }
}
```

### Retry conditionnel

```qml
function onFetchError(errorMessage) {
    // Ne retry que pour erreurs r√©seau
    if (errorMessage.includes("NetworkError")) {
        if (retryCount < maxRetries) {
            retryCount++
            retryTimer.start()
            return
        }
    }
    
    // Autres erreurs : pas de retry
    Model.FilmDataSingletonModel.setError(errorMessage)
}
```

---

## √âvolutions futures

### M√©thode POST : Ajouter un film

```qml
function addFilm(filmData) {
    let url = apiUrl + "/movies/"
    
    HttpRequest.post(url)
        .header("Content-Type", "application/json")
        .body(JSON.stringify(filmData))
        .then(function(response) {
            var newFilm = JSON.parse(response)
            filmAdded(newFilm)
        })
        .catch(function(error) {
            fetchError("Erreur ajout: " + error)
        })
}

signal filmAdded(var film)
```

### M√©thode PUT : Modifier un film

```qml
function updateFilm(filmId, filmData) {
    let url = apiUrl + "/movies/" + filmId + "/"
    
    HttpRequest.put(url)
        .header("Content-Type", "application/json")
        .body(JSON.stringify(filmData))
        .then(function(response) {
            var updatedFilm = JSON.parse(response)
            filmUpdated(updatedFilm)
        })
        .catch(function(error) {
            fetchError("Erreur modification: " + error)
        })
}

signal filmUpdated(var film)
```

### M√©thode DELETE : Supprimer un film

```qml
function deleteFilm(filmId) {
    let url = apiUrl + "/movies/" + filmId + "/"
    
    HttpRequest.del(url)
        .then(function() {
            filmDeleted(filmId)
        })
        .catch(function(error) {
            fetchError("Erreur suppression: " + error)
        })
}

signal filmDeleted(int filmId)
```

### Authentification JWT

```qml
property string authToken: ""

function fetchAllFilms() {
    let url = apiUrl + "/movies/"
    
    HttpRequest.get(url)
        .header("Authorization", "Bearer " + authToken)
        .then(function(response) {
            filmsFetched(JSON.parse(response))
        })
        .catch(function(error) {
            if (error.includes("401")) {
                authenticationRequired()  // Signal sp√©cial
            } else {
                fetchError("Erreur: " + error)
            }
        })
}

signal authenticationRequired()
```

---

## Bonnes pratiques

### ‚úÖ √Ä faire

**1. Instancier dans Logic**
```qml
// ‚úÖ BON
Item {
    id: catalogueLogic
    
    FilmService { id: filmService }
}
```

**2. √âcouter signaux dans Logic**
```qml
// ‚úÖ BON
Connections {
    target: filmService
    function onFilmsFetched(films) {
        // Transformation et stockage
    }
}
```

**3. Configurer apiUrl selon environnement**
```qml
// ‚úÖ BON
apiUrl: Qt.application.arguments.indexOf("--prod") !== -1 
    ? "https://api.cinevault.com/api"
    : "http://localhost:8000/api"
```

**4. Logs pour debugging**
```qml
// ‚úÖ BON
console.log("üåê API call:", url)
console.log("‚úÖ API success:", films.length)
console.error("‚ùå API error:", error)
```

### ‚ùå √Ä √©viter

**1. Pas de logique m√©tier**
```qml
// ‚ùå MAUVAIS
function fetchAllFilms() {
    HttpRequest.get(url).then(function(response) {
        var films = JSON.parse(response)
        var filtered = films.filter(f => f.year > 2020)  // ‚ùå
        filmsFetched(filtered)
    })
}

// ‚úÖ BON : Donn√©es brutes
function fetchAllFilms() {
    HttpRequest.get(url).then(function(response) {
        filmsFetched(JSON.parse(response))  // ‚úÖ
    })
}
```

**2. Pas de manipulation directe du Model**
```qml
// ‚ùå MAUVAIS
function fetchAllFilms() {
    HttpRequest.get(url).then(function(response) {
        FilmDataSingletonModel.films = JSON.parse(response)  // ‚ùå
    })
}

// ‚úÖ BON : Via signal
function fetchAllFilms() {
    HttpRequest.get(url).then(function(response) {
        filmsFetched(JSON.parse(response))  // ‚úÖ Signal
    })
}
```

**3. Pas d'instanciation dans Vue**
```qml
// ‚ùå MAUVAIS
CataloguePage {
    FilmService { id: service }
    Button {
        onClicked: service.fetchAllFilms()
    }
}

// ‚úÖ BON : Via Logic
CataloguePage {
    CatalogueLogic { id: logic }
    Button {
        onClicked: logic.refreshCatalogue()
    }
}
```

---

## Testing

### Mock complet

```qml
Item {
    id: mockFilmService
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // PROPRI√âT√âS DE TEST
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    property bool __testMode: true
    property var __mockResponse: [
        {id: 1, title: "Film 1", poster_url: "url1"},
        {id: 2, title: "Film 2", poster_url: "url2"}
    ]
    property bool __mockError: false
    property string __mockErrorMessage: "Test error"
    property int __mockDelay: 100  // ms
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // SIGNAUX (identiques au vrai service)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    signal filmsFetched(var films)
    signal fetchError(string message)
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // M√âTHODE MOCK√âE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    function fetchAllFilms() {
        if (!__testMode) {
            // Mode normal (√† impl√©menter si n√©cessaire)
            return
        }
        
        // Simule d√©lai r√©seau
        mockTimer.start()
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // TIMER POUR SIMULATION
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    Timer {
        id: mockTimer
        interval: __mockDelay
        repeat: false
        onTriggered: {
            if (__mockError) {
                fetchError(__mockErrorMessage)
            } else {
                filmsFetched(__mockResponse)
            }
        }
    }
}
```

### Tests unitaires

```qml
TestCase {
    name: "FilmServiceTests"
    
    property var service: FilmService {
        apiUrl: "http://localhost:8000/api"
    }
    
    SignalSpy {
        id: fetchedSpy
        target: service
        signalName: "filmsFetched"
    }
    
    SignalSpy {
        id: errorSpy
        target: service
        signalName: "fetchError"
    }
    
    function test_fetchAllFilms_success() {
        fetchedSpy.clear()
        
        // Mock r√©ponse (n√©cessite mock du backend ou HttpRequest)
        service.__mockResponse = [{id:1, title:"Film"}]
        service.fetchAllFilms()
        
        // Attendre signal
        fetchedSpy.wait(5000)
        
        // V√©rifier
        compare(fetchedSpy.count, 1)
        var films = fetchedSpy.signalArguments[0][0]
        compare(films.length, 1)
        compare(films[0].title, "Film")
    }
    
    function test_fetchAllFilms_error() {
        errorSpy.clear()
        
        // Simuler erreur
        service.__mockError = true
        service.fetchAllFilms()
        
        // Attendre signal
        errorSpy.wait(5000)
        
        // V√©rifier
        compare(errorSpy.count, 1)
    }
}
```

---

## R√©f√©rences

- [Architecture MVC](../architecture/mvc-pattern.md)
- [Flux de donn√©es](../architecture/data-flow.md)
- [FilmDataSingletonModel](FilmDataSingletonModel-detailed.md)
- [CatalogueLogic](../logic/CatalogueLogic.md)
- [Felgo HttpRequest Documentation](https://felgo.com/doc/felgo-httprequest/)
- [Django REST Framework](https://www.django-rest-framework.org/)
